<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeafWay </title>
    <link rel="icon" href="leaf.png" type="image/png">
    <style>
      @import url(https://fonts.googleapis.com/css2?family=Lato&display=swap);
      @import url(https://fonts.googleapis.com/css2?family=Open+Sans&display=swap);
      @import url(https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200);
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        content: ["./public/**/*.{html,js}"], // Updated content path
        theme: {"name":"Custom","fontFamily":{"sans":["Open Sans","ui-sans-serif","system-ui","sans-serif","\"Apple Color Emoji\"","\"Segoe UI Emoji\"","\"Segoe UI Symbol\"","\"Noto Color Emoji\""]},"extend":{"fontFamily":{"title":["Lato","ui-sans-serif","system-ui","sans-serif","\"Apple Color Emoji\"","\"Segoe UI Emoji\"","\"Segoe UI Symbol\"","\"Noto Color Emoji\""],"body":["Open Sans","ui-sans-serif","system-ui","sans-serif","\"Apple Color Emoji\"","\"Segoe UI Emoji\"","\"Segoe UI Symbol\"","\"Noto Color Emoji\""]},"colors":{"neutral":{"50":"#f7f7f7","100":"#eeeeee","200":"#e0e0e0","300":"#cacaca","400":"#b1b1b1","500":"#999999","600":"#7f7f7f","700":"#676767","800":"#545454","900":"#464646","950":"#282828"},"primary":{"50":"#f9f7f7","100":"#f1efef","200":"#e7e1e1","300":"#dad2d2","400":"#bcadad","500":"#a29191","600":"#8a7878","700":"#736262","800":"#615353","900":"#534949","950":"#2b2424","DEFAULT":"#dad2d2"}}},"fontSize":{"xs":["12px",{"lineHeight":"19.200000000000003px"}],"sm":["14px",{"lineHeight":"21px"}],"base":["16px",{"lineHeight":"25.6px"}],"lg":["18px",{"lineHeight":"27px"}],"xl":["20px",{"lineHeight":"28px"}],"2xl":["24px",{"lineHeight":"31.200000000000003px"}],"3xl":["30px",{"lineHeight":"36px"}],"4xl":["36px",{"lineHeight":"41.4px"}],"5xl":["48px",{"lineHeight":"52.800000000000004px"}],"6xl":["60px",{"lineHeight":"66px"}],"7xl":["72px",{"lineHeight":"75.60000000000001px"}],"8xl":["96px",{"lineHeight":"100.80000000000001px"}],"9xl":["128px",{"lineHeight":"134.4px"}]},"borderRadius":{"none":"0px","sm":"6px","DEFAULT":"12px","md":"18px","lg":"24px","xl":"36px","2xl":"48px","3xl":"72px","full":"9999px"},"spacing":{"0":"0px","1":"4px","2":"8px","3":"12px","4":"16px","5":"20px","6":"24px","7":"28px","8":"32px","9":"36px","10":"40px","11":"44px","12":"48px","14":"56px","16":"64px","20":"80px","24":"96px","28":"112px","32":"128px","36":"144px","40":"160px","44":"176px","48":"192px","52":"208px","56":"224px","60":"240px","64":"256px","72":"288px","80":"320px","96":"384px","px":"1px","0.5":"2px","1.5":"6px","2.5":"10px","3.5":"14px"}},
        plugins: [],
        important: '#webcrumbs'
      };
    </script>
    <style>
      .form-label { @apply block text-sm font-medium text-gray-700 mb-2; }
      .form-input { @apply mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm; }
      .form-select { @apply mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md; }
      .submit-button { @apply w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all transform hover:translate-y-[-2px] hover:shadow-lg; }
      @keyframes spin { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }
      .perspective-\[1000px\] { perspective: 1000px; }
      .transform-style-preserve-3d { transform-style: preserve-3d; }
      .animate-\[spin_20s_linear_infinite\] { animation: spin 20s linear infinite; }
      .hover\:animate-\[spin_5s_linear_infinite\]:hover { animation: spin 5s linear infinite; }
      .rotateY\(0deg\) { transform: rotateY(0deg); }
      .rotateY\(120deg\) { transform: rotateY(120deg); }
      .rotateY\(240deg\) { transform: rotateY(240deg); }
      .translateZ\(200px\) { transform: translateZ(200px); }
      .input-focus-effect { transition: all 0.3s ease; border: 2px solid transparent; }
      .input-focus-effect:focus, .input-focus-effect:hover { border-color: #8a7878; box-shadow: 0 0 0 3px rgba(138, 120, 120, 0.2); transform: translateY(-2px); }
      @keyframes formGlow { 0% { box-shadow: 0 0 10px rgba(138, 120, 120, 0.2); } 50% { box-shadow: 0 0 20px rgba(138, 120, 120, 0.4); } 100% { box-shadow: 0 0 10px rgba(138, 120, 120, 0.2); } }
      .form-glow-effect { animation: formGlow 3s infinite; }
      /* Results styles */
      .loader { border: 4px solid #f3f3f3; border-top: 4px solid #8a7878; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
      .best-option { border: 2px solid #4ade80; background-color: #f0fdf4; }
      .co2-low { color: #16a34a; }
      .co2-medium { color: #ca8a04; }
      .co2-high { color: #dc2626; }
      #results-container { display: none; } /* Hide results initially */
    </style>
  </head>
  <body class="bg-gray-50">
    <div id="webcrumbs" class="w-full max-w-6xl mx-auto p-4 md:p-8">
      <div class="bg-gradient-to-br from-violet-50 to-violet-100 rounded-xl overflow-hidden shadow-lg">
        <div class="p-8 flex flex-col md:flex-row items-center">
          <div class="md:w-1/2 pr-8 mb-8 md:mb-0">
            <h1 class="text-4xl font-bold text-primary-800 mb-4 font-title">LeafWay Transportation Predictor</h1>
            <p class="text-lg text-gray-700 mb-6 font-body">Make smarter, greener transportation choices. Enter your trip details below to get personalized recommendations.</p>

            <!-- Prediction Form -->
            <form id="prediction-form" class="space-y-6 bg-gradient-to-r from-violet-50 via-white to-violet-50 p-8 rounded-xl shadow-lg border border-violet-100 relative overflow-hidden form-glow-effect">
              <div class="absolute top-0 right-0 w-32 h-32 bg-primary-100 rounded-full -mr-16 -mt-16 opacity-50"></div>
              <div class="absolute bottom-0 left-0 w-24 h-24 bg-violet-100 rounded-full -ml-12 -mb-12 opacity-50"></div>
              <h3 class="text-xl font-semibold text-primary-700 mb-4 relative z-10 flex items-center">
                <span class="material-symbols-outlined mr-2 text-violet-500">directions</span> Enter Your Trip Details
              </h3>
              <div class="relative z-10 group">
                <label for="distance" class="form-label flex items-center"><span class="material-symbols-outlined mr-1 text-primary-500">straighten</span> Distance (km)</label>
                <div class="relative">
                  <input type="number" name="distance" id="distance" step="0.1" min="0.1" required class="form-input pl-10 input-focus-effect border-primary-200 focus:border-primary-400 hover:border-primary-300" placeholder="e.g., 10.5">
                  <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-hover:text-primary-500 transition-colors duration-300">route</span>
                </div>
              </div>
              <div class="relative z-10 group">
                <label for="route_type" class="form-label flex items-center"><span class="material-symbols-outlined mr-1 text-primary-500">map</span> Route Type</label>
                <div class="relative">
                  <select name="route_type" id="route_type" required class="form-select pl-10 input-focus-effect border-primary-200 focus:border-primary-400 hover:border-primary-300">
                    <option value="" disabled selected>Select route type</option>
                    <option value="Urban">Urban</option>
                    <option value="Rural">Rural</option>
                  </select>
                  <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-hover:text-primary-500 transition-colors duration-300">signpost</span>
                </div>
              </div>
              <div class="relative z-10 group">
                <label for="time_of_day" class="form-label flex items-center"><span class="material-symbols-outlined mr-1 text-primary-500">schedule</span> Time of Day</label>
                <div class="relative">
                  <select name="time_of_day" id="time_of_day" required class="form-select pl-10 input-focus-effect border-primary-200 focus:border-primary-400 hover:border-primary-300">
                    <option value="" disabled selected>Select time of day</option>
                    <option value="Morning">Morning</option>
                    <option value="Afternoon">Afternoon</option>
                    <option value="Evening">Evening</option>
                    <option value="Night">Night</option>
                  </select>
                  <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-hover:text-primary-500 transition-colors duration-300">schedule</span>
                </div>
              </div>
              <div class="relative z-10 pt-2">
                <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-gradient-to-r from-violet-500 to-purple-600 hover:from-violet-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 transition-all transform hover:translate-y-[-2px] hover:shadow-lg">
                  <span class="material-symbols-outlined mr-2">travel_explore</span> Predict Transportation
                </button>
              </div>
              <div class="mt-4 text-xs text-gray-500 italic flex items-center justify-center border-t border-violet-100 pt-4">
                <span class="material-symbols-outlined text-green-500 mr-1">eco</span> Tip: Walking or cycling is best for trips under 5km!
              </div>
            </form>
            <!-- End Prediction Form -->

            <!-- Results Display Area -->
            <div id="results-container" class="mt-8 p-6 rounded-lg shadow bg-white border border-gray-200">
                <h2 class="text-2xl font-semibold text-primary-700 mb-4 text-center">Prediction Results</h2>
                <div id="results-content">
                    <!-- Results will be injected here by JavaScript -->
                    <div class="loader"></div>
                    <p class="text-center text-gray-500">Loading results...</p>
                </div>
                <div class="mt-6 text-center">
                    <button id="clear-results-button" class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-100 rounded-lg font-medium text-sm transition-colors">
                        Clear Results
                    </button>
                </div>
            </div>
            <!-- End Results Display Area -->

            <!-- Feature Highlights -->
            <div class="mt-8">
              <h2 class="text-2xl font-semibold text-primary-700 mb-4">Why Choose Eco-Friendly?</h2>
              <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-primary-200 flex items-center justify-center mr-3"> <span class="material-symbols-outlined text-primary-700">eco</span> </div>
                <div> <h3 class="font-semibold text-md text-primary-700">Reduce Carbon Footprint</h3> <p class="text-sm text-gray-600">Help protect the environment.</p> </div>
              </div>
              <div class="flex items-center mb-4">
                 <div class="w-10 h-10 rounded-full bg-primary-200 flex items-center justify-center mr-3"> <span class="material-symbols-outlined text-primary-700">savings</span> </div>
                 <div> <h3 class="font-semibold text-md text-primary-700">Save Money</h3> <p class="text-sm text-gray-600">Find cost-effective options.</p> </div>
              </div>
               <div class="flex items-center">
                 <div class="w-10 h-10 rounded-full bg-primary-200 flex items-center justify-center mr-3"> <span class="material-symbols-outlined text-primary-700">route</span> </div>
                 <div> <h3 class="font-semibold text-md text-primary-700">Optimize Your Travel</h3> <p class="text-sm text-gray-600">Discover efficient choices.</p> </div>
               </div>
            </div>
            <!-- End Feature Highlights -->

          </div>

          <!-- Rotating Cards Section -->
          <div class="md:w-1/2 relative h-[400px] md:h-[500px] perspective-[1000px] mt-8 md:mt-0">
            <div class="absolute w-full h-full transform-style-preserve-3d animate-[spin_20s_linear_infinite] hover:animate-[spin_5s_linear_infinite] group">
              <div class="absolute inset-0 w-full h-full bg-gradient-to-b from-primary-200 to-primary-300 rounded-2xl shadow-xl transform rotateY(0deg) translateZ(150px) md:translateZ(200px) p-4 md:p-6 opacity-90 transition-all duration-300 hover:opacity-100 hover:shadow-2xl hover:scale-105">
                <div class="bg-white rounded-lg p-4 h-full flex flex-col backdrop-blur-sm bg-white/90 hover:bg-white">
                  <div class="flex justify-between items-center mb-3"> <h3 class="font-bold text-lg md:text-xl text-primary-700">Public Transport</h3> <span class="material-symbols-outlined text-primary-600 text-xl md:text-2xl">directions_bus</span> </div>
                  <div class="bg-primary-50 rounded-lg p-3 mb-3"> <div class="flex justify-between mb-1 text-sm"> <span class="text-gray-600">CO2 Reduction</span> <span class="font-semibold text-green-600">High</span> </div> <div class="w-full bg-gray-200 rounded-full h-2"> <div class="bg-green-500 h-2 rounded-full w-[75%]"></div> </div> </div>
                  <p class="text-sm text-gray-600 flex-grow">A great option for reducing emissions on many routes.</p>
                  <div class="flex justify-between text-xs md:text-sm text-gray-500 mt-2"> <span>Cost: Low</span> <span>Time: Varies</span> </div>
                </div>
              </div>
               <div class="absolute inset-0 w-full h-full bg-gradient-to-b from-blue-200 to-blue-300 rounded-2xl shadow-xl transform rotateY(120deg) translateZ(150px) md:translateZ(200px) p-4 md:p-6 opacity-90 transition-all duration-300 hover:opacity-100 hover:shadow-2xl hover:scale-105">
                 <div class="bg-white rounded-lg p-4 h-full flex flex-col backdrop-blur-sm bg-white/90 hover:bg-white">
                   <div class="flex justify-between items-center mb-3"> <h3 class="font-bold text-lg md:text-xl text-blue-700">Biking / Walking</h3> <span class="material-symbols-outlined text-blue-600 text-xl md:text-2xl">pedal_bike</span> </div>
                   <div class="bg-blue-50 rounded-lg p-3 mb-3"> <div class="flex justify-between mb-1 text-sm"> <span class="text-gray-600">CO2 Reduction</span> <span class="font-semibold text-green-600">Maximum</span> </div> <div class="w-full bg-gray-200 rounded-full h-2"> <div class="bg-green-500 h-2 rounded-full w-[100%]"></div> </div> </div>
                   <p class="text-sm text-gray-600 flex-grow">Zero emissions and great for your health!</p>
                   <div class="flex justify-between text-xs md:text-sm text-gray-500 mt-2"> <span>Cost: Free</span> <span>Time: Depends</span> </div>
                 </div>
               </div>
              <div class="absolute inset-0 w-full h-full bg-gradient-to-b from-amber-200 to-amber-300 rounded-2xl shadow-xl transform rotateY(240deg) translateZ(150px) md:translateZ(200px) p-4 md:p-6 opacity-90 transition-all duration-300 hover:opacity-100 hover:shadow-2xl hover:scale-105">
                <div class="bg-white rounded-lg p-4 h-full flex flex-col backdrop-blur-sm bg-white/90 hover:bg-white">
                  <div class="flex justify-between items-center mb-3"> <h3 class="font-bold text-lg md:text-xl text-amber-700">Driving (Car)</h3> <span class="material-symbols-outlined text-amber-600 text-xl md:text-2xl">directions_car</span> </div>
                  <div class="bg-amber-50 rounded-lg p-3 mb-3"> <div class="flex justify-between mb-1 text-sm"> <span class="text-gray-600">CO2 Reduction</span> <span class="font-semibold text-red-600">Low</span> </div> <div class="w-full bg-gray-200 rounded-full h-2"> <div class="bg-red-500 h-2 rounded-full w-[10%]"></div> </div> </div>
                   <p class="text-sm text-gray-600 flex-grow">Consider alternatives for a smaller footprint.</p>
                   <div class="flex justify-between text-xs md:text-sm text-gray-500 mt-2"> <span>Cost: Varies</span> <span>Time: Often Fast</span> </div>
                </div>
              </div>
            </div>
          </div>
          <!-- End Rotating Cards Section -->

        </div>
        <!-- Footer Section -->
        <div class="bg-primary-800 text-white py-4 px-8 text-center text-sm">
            Rishav kr. | Powered by Creativity
        </div>
        <!-- End Footer Section -->
      </div>
    </div>

    <script>
        const form = document.getElementById('prediction-form');
        const resultsContainer = document.getElementById('results-container');
        const resultsContent = document.getElementById('results-content');
        const clearButton = document.getElementById('clear-results-button');

        form.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent default form submission

            // Show loading state
            resultsContainer.style.display = 'block';
            resultsContent.innerHTML = `
                <div class="loader"></div>
                <p class="text-center text-gray-500">Fetching prediction...</p>`;

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                const prediction = await response.json();

                if (!response.ok || prediction.error) {
                    throw new Error(prediction.error || `HTTP error! status: ${response.status}`);
                }

                displayResults(prediction);

            } catch (error) {
                resultsContent.innerHTML = `
                    <div class="text-center text-red-600 bg-red-100 p-4 rounded-md">
                        <h2 class="text-xl font-semibold mb-2">Error Fetching Prediction</h2>
                        <p>${error.message}</p>
                    </div>`;
            }
        });

        clearButton.addEventListener('click', () => {
            resultsContainer.style.display = 'none';
            resultsContent.innerHTML = ''; // Clear content
        });

        function displayResults(prediction) {
            const predictedCO2 = prediction.emissions_by_mode[prediction.predicted_mode];
            const co2PerKm = predictedCO2 > 0 ? (predictedCO2 / prediction.input_distance).toFixed(1) : 0;

            let co2Class = 'co2-high';
            if (predictedCO2 === 0) co2Class = 'co2-low';
            else if (predictedCO2 < 50) co2Class = 'co2-low';
            else if (predictedCO2 < 150) co2Class = 'co2-medium';

            let allModesHtml = prediction.all_modes_ranked.map(([mode, prob], index) => {
                const co2 = prediction.emissions_by_mode[mode];
                const modeCo2PerKm = co2 > 0 ? (co2 / prediction.input_distance).toFixed(1) : 0;
                let modeCo2Class = 'co2-high';
                 if (co2 === 0) modeCo2Class = 'co2-low';
                 else if (co2 < 50) modeCo2Class = 'co2-low';
                 else if (co2 < 150) modeCo2Class = 'co2-medium';

                return `
                    <div class="p-4 border border-gray-200 rounded-md bg-gray-50 hover:shadow-sm transition-shadow">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-lg text-primary-800">${index + 1}. ${mode}</span>
                            <span class="text-sm text-gray-600">Likelihood: ${(prob * 100).toFixed(0)}%</span>
                        </div>
                        <div class="text-sm text-gray-700 mt-1">
                            Estimated CO2:
                            <span class="font-semibold ${modeCo2Class}">${co2}g</span>
                            ${co2 > 0 ? `<span class="text-xs text-gray-500"> (${modeCo2PerKm}g/km)</span>` : ''}
                        </div>
                    </div>`;
            }).join('');

            resultsContent.innerHTML = `
                <div class="text-center mb-4 text-gray-600 font-body">
                    For a <strong>${prediction.input_distance} km</strong> trip (${prediction.input_route}, ${prediction.input_time}):
                </div>
                <div class="mb-6 p-6 rounded-lg best-option shadow">
                    <h3 class="text-xl font-semibold text-primary-700 mb-3 flex items-center">
                        <span class="material-symbols-outlined mr-2 text-green-600">recommend</span> Recommended: ${prediction.predicted_mode}
                    </h3>
                    <p class="text-md text-gray-800 mb-1">
                        Confidence: <span class="font-semibold">${(prediction.confidence * 100).toFixed(0)}%</span>
                    </p>
                    <p class="text-md text-gray-800">
                        Estimated CO2: <span class="font-semibold ${co2Class}">${predictedCO2}g</span>
                        ${predictedCO2 > 0 ? `<span class="text-sm text-gray-500"> (${co2PerKm}g/km)</span>` : ''}
                    </p>
                </div>
                <h3 class="text-lg font-semibold text-primary-700 mb-3">All Options Ranked:</h3>
                <div class="space-y-3">
                    ${allModesHtml}
                </div>`;
        }
    </script>

  </body>
</html>
